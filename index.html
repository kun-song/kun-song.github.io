<!DOCTYPE html>







<html class="theme-next pisces" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  

  

  

  

  

  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Java for living, Scala for fun!">
<meta property="og:type" content="website">
<meta property="og:title" content="随便写写">
<meta property="og:url" content="http://songkun.me/index.html">
<meta property="og:site_name" content="随便写写">
<meta property="og:description" content="Java for living, Scala for fun!">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="随便写写">
<meta name="twitter:description" content="Java for living, Scala for fun!">






  <link rel="canonical" href="http://songkun.me/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>随便写写</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?846ea2c0fbfe48d1fc36a417a790a68c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/satansk"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Follow me on GitHub"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">随便写写</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-books">
    <a href="/books" rel="section">
      <i class="menu-item-icon fa fa-fw fa-book"></i> <br />书单</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/09/23/2018-09-23-mongodb-index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/23/2018-09-23-mongodb-index/" itemprop="url">
                  MongoDB | 索引
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-23 23:17:10" itemprop="dateCreated datePublished" datetime="2018-09-23T23:17:10+08:00">2018-09-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-09-24 16:55:23" itemprop="dateModified" datetime="2018-09-24T16:55:23+08:00">2018-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/23/2018-09-23-mongodb-index/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/23/2018-09-23-mongodb-index/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基本术语"><a href="#基本术语" class="headerlink" title="基本术语"></a>基本术语</h2><p><a href="https://docs.mongodb.com/manual/reference/glossary/" target="_blank" rel="noopener">MongoDB 术语表</a></p>
<h3 id="index-key-data-page"><a href="#index-key-data-page" class="headerlink" title="index/key/data page"></a>index/key/data page</h3><p>MongoDB 索引由 key 和 data page 两部分组成：</p>
<ul>
<li>key 是文档的 <strong>字段集合</strong>；</li>
<li>data page 是存储在 disk 上的 document 的入口，有时也叫 pointer；</li>
</ul>
<p>数据库中的索引（index）非常像书本的“索引”，作用是加速读操作，key 类似书本索引的关键字，而 data page 类似页码。</p>
<h3 id="covered-query-fetch"><a href="#covered-query-fetch" class="headerlink" title="covered query/fetch"></a>covered query/fetch</h3><p>一般而言，读操作分为两步：</p>
<ol>
<li>由索引的 key 找到目标文档的 data page；</li>
<li>根据 data page 将文档从磁盘 fetch 出来；</li>
</ol>
<p>若 <strong>所需字段</strong> 都在索引中，则不需要磁盘 fetch 就能获取所需数据，这就是 covered query。</p>
<p>查询覆盖（covered query）一般用于高并发、性能要求高的场景，可进一步加速读操作，但随之而来的是索引变大，需要更大的内存支撑。</p>
<h3 id="ixscan-collscan"><a href="#ixscan-collscan" class="headerlink" title="ixscan/collscan"></a>ixscan/collscan</h3><p>ixscan（索引扫描）和 collscan（集合扫描）效率差别很大：</p>
<ul>
<li>未命中索引时为 collscan，此时需要 fetch 磁盘上的所有文档才能完成查询，时间复杂度为 O(n)，查询效率随文档数量增加而急剧下降；</li>
<li>命中索引时为 ixscan，由于索引的底层数据结构（B 树）具备 O(logn) 的查询效率，因此即使文档数量急剧增加，查询效率下降不明显；</li>
</ul>
<p><img src="/images/mongodb/ixscan-collscan.png" alt="ixscan vs collscan" style="width: 400px;"></p>
<h3 id="query-shape"><a href="#query-shape" class="headerlink" title="query shape"></a>query shape</h3><p><a href="https://docs.mongodb.com/manual/reference/glossary/#term-query-shape" target="_blank" rel="noopener">query shape</a> 决定 <a href="https://docs.mongodb.com/manual/core/query-plans/" target="_blank" rel="noopener">query plan</a>。</p>
<p>例如 <code>db.test.find({name: &quot;Mike&quot;, age: 10})</code> 和 <code>db.test.find({name: &quot;Bob&quot;, age: 20})</code> 的 query shape 相同，都是 <code>{name: 1, age: 1}</code>，因此这两个查询的 query plan 也相同，将使用相同的 index 加速查询。</p>
<h3 id="index-prefix"><a href="#index-prefix" class="headerlink" title="index prefix"></a>index prefix</h3><p>复合索引有索引前缀的概念，例如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.createIndex</span>(&#123;<span class="attribute">firstName</span>: <span class="number">1</span>, lastName: <span class="number">1</span>, gender: <span class="number">1</span>, age: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>以上索引有 3 个前缀：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attribute">firstName</span>: <span class="number">1</span>&#125;</span><br><span class="line">&#123;<span class="attribute">firstName</span>: <span class="number">1</span>, lastName: <span class="number">1</span>&#125;</span><br><span class="line">&#123;<span class="attribute">firstName</span>: <span class="number">1</span>, lastName: <span class="number">1</span>, age: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>
<p>以上 3 个索引都是 <code>{firstName: 1, lastName: 1, gender: 1, age: 1}</code> 的前缀，将被其覆盖，没有必要单独创建，以避免浪费内存、磁盘空间。</p>
<h3 id="selectivity"><a href="#selectivity" class="headerlink" title="selectivity"></a>selectivity</h3><p>过滤性是指 index 过滤数据的能力，创建索引时，过滤性是重要的参考依据。</p>
<p>假设集合中有 10000 条文档，且：</p>
<ul>
<li>满足 <code>a = 100</code> 的文档有 1000 条</li>
<li>满足 <code>b = 10</code> 的文档有 100 条</li>
<li>满足 <code>c = 1</code> 的文档有 10 条</li>
</ul>
<p>则就过滤性而言，c &gt; b &gt; a，按照 c 过滤后的结果集最小。</p>
<p>若查询条件为 <code>a == 100 &amp;&amp; b == 10 &amp;&amp; c == 1</code>，且只能创建一个索引，则选择 c。</p>
<h3 id="复合索引-vs-多个单独索引"><a href="#复合索引-vs-多个单独索引" class="headerlink" title="复合索引 vs 多个单独索引"></a>复合索引 vs 多个单独索引</h3><p>接着前面的例子，对于 <code>a == 100 &amp;&amp; b == 10 &amp;&amp; c == 1</code>，考虑两种索引方式：</p>
<ul>
<li>复合索引 <code>{a: 1, b: 1, c: 1}</code></li>
<li>3 个单独索引：<ul>
<li><code>{a: 1}</code></li>
<li><code>{b: 1}</code></li>
<li><code>{c: 1}</code></li>
</ul>
</li>
</ul>
<p>如果使用 3 个单独索引，MongoDB 需要先分别为每个索引查询，得到 3 个结果集，然后在内存中取 3 个结果集的交集，非常耗时；如果是复合索引，则只会得到 1 个结果集，没有取交集的动作。</p>
<p>3 个单独索引还不如仅创建 <code>{c: 1}</code> 一个索引，如果你发现自己正在使用多个单独索引，那就要仔细考虑下了，一般会有更好的索引方式。</p>
<p>在传统的关系型数据库中，多个单独索引比在 MongoDB 中常见一些，原因是 MongoDB 是分布式数据库，为每个索引单独查询，然后取交集的代价非常大，因此 MongoDB 很不推荐这种做法。</p>
<h2 id="索引原理"><a href="#索引原理" class="headerlink" title="索引原理"></a>索引原理</h2><p>MongoDB 有以下索引类型：</p>
<ul>
<li>单字段索引（single-field index）</li>
<li>复合索引（compound index）</li>
<li>多键索引（multikey index）</li>
<li>地理位置索引（geospatial index）</li>
<li>全文索引（text index）</li>
</ul>
<p>其中单字段索引可以认为是只有一个字段的复合索引，而多键索引是建立在数组上的索引。</p>
<h3 id="索引的数据结构"><a href="#索引的数据结构" class="headerlink" title="索引的数据结构"></a>索引的数据结构</h3><p>不管是 NoSQL 还是关系型数据库，索引的原理基本都是相同的，其数据结构为 B/B+ 树，注意 B 树并不是 binary tree，而是 self-balancing tree。</p>
<p>索引可以用数组实现，也可以用 B 树实现，两者都可以实现高效查找：</p>
<ul>
<li>O(logn) 查找时间复杂度</li>
</ul>
<p>区别是插入时，维护数组的有序性代价非常高，而 B 树代价相对较低，因此数据库一般用 B 树实现数组。</p>
<p>虽然实际是用 B 树实现的，但可以用数组来讲解。</p>
<h4 id="单字段索引"><a href="#单字段索引" class="headerlink" title="单字段索引"></a>单字段索引</h4><p>索引 <code>{a: 1}</code>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">a</span>: <span class="number">1</span>&#125;)    <span class="selector-attr">[1]</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">a</span>: <span class="number">10</span>&#125;)   <span class="selector-attr">[1, 10]</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">a</span>: <span class="number">5</span>&#125;)    <span class="selector-attr">[1, 5, 10]</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">a</span>: <span class="number">7</span>&#125;)    <span class="selector-attr">[1, 5, 7, 10]</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">a</span>: <span class="number">3</span>&#125;)    <span class="selector-attr">[1, 3, 5, 7, 10]</span></span><br></pre></td></tr></table></figure>
<p>当插入、删除元素时，索引总是 <strong>保持有序</strong>，因为在有序 B 树/数组上，可以采用注入二分查找等算法，可以达到 O(logn) 的时间复杂度。</p>
<h4 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h4><p>索引 <code>{a: 1, b: 1}</code>：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: <span class="number">1</span>&#125;)    [&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: &#123;<span class="number">1</span>&#125;&#125;]</span><br><span class="line">db<span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: <span class="number">10</span>&#125;)   [&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: &#123;<span class="number">1</span>, <span class="number">10</span>&#125;&#125;]</span><br><span class="line">db<span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="selector-tag">a</span>: <span class="number">5</span>, <span class="selector-tag">b</span>: <span class="number">10</span>&#125;)   [&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: &#123;<span class="number">1</span>, <span class="number">10</span>&#125;&#125;, &#123;<span class="selector-tag">a</span>: <span class="number">5</span>, <span class="selector-tag">b</span>: &#123;<span class="number">10</span>&#125;&#125;]</span><br><span class="line">db<span class="selector-class">.test</span><span class="selector-class">.insert</span>(&#123;<span class="selector-tag">a</span>: <span class="number">5</span>, <span class="selector-tag">b</span>: <span class="number">7</span>&#125;)    [&#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="selector-tag">b</span>: &#123;<span class="number">1</span>, <span class="number">10</span>&#125;&#125;, &#123;<span class="selector-tag">a</span>: <span class="number">5</span>, <span class="selector-tag">b</span>: &#123;<span class="number">7</span>, <span class="number">10</span>&#125;&#125;]</span><br></pre></td></tr></table></figure>
<p>对于 <code>db.test.find({a: 5, b: 7})</code>，首先在 <code>[1, 5]</code> 上搜索 <code>a == 5</code>，然后在 <code>[7, 10]</code> 数组上搜索 <code>b == 7</code>，因为是有序数组，可以用二分查找，时间复杂度为 O(logn)。</p>
<h3 id="索引作用：过滤"><a href="#索引作用：过滤" class="headerlink" title="索引作用：过滤"></a>索引作用：过滤</h3><p>索引最初的目的：加速查询。</p>
<p>假设索引为 <code>{a: 1, b: 1, c: 1}</code>，且索引内容为：</p>
<p><img src="/images/mongodb/index-filter-1.png" style="width: 400px;"></p>
<p>精确查询 <code>find({a: 2, b: 2, c: 3})</code> 过程如下：</p>
<p><img src="/images/mongodb/index-filter-2.png" style="width: 400px;"></p>
<p>范围查询 <code>find({a: 2, b: {$gte: 2, $lte: 3}, c: 1})</code> 过程如下：</p>
<p><img src="/images/mongodb/index-filter-3.png" style="width: 400px;"></p>
<p>范围查询 <code>find({a: 2, b: 3, c: {$gte: 2, $lte: 4}})</code> 过程如下：</p>
<p><img src="/images/mongodb/index-filter-4.png" style="width: 400px;"></p>
<p>无论是精确查询，还是范围查询，利用索引都能达到很好的查询效率。</p>
<h3 id="索引作用：排序"><a href="#索引作用：排序" class="headerlink" title="索引作用：排序"></a>索引作用：排序</h3><p>索引是有序的，如果按照索引顺序进行 <strong>遍历</strong>，则遍历结果也是有序的，可省去对结果集进行 <strong>内存排序</strong>，因此索引有助于排序。</p>
<blockquote>
<p>注意：</p>
<ul>
<li>并非是先查找到一个结果集，然后用索引对该结果集进行排序；</li>
<li>索引只有助于部分排序，内存排序有时无法避免；</li>
</ul>
</blockquote>
<p>假设有索引 <code>{a: 1, b: 1, c: 1}</code>，对于 <code>find({a: 2}).sort({b: -1, c: 1})</code>，借助索引，可以避免内存排序：</p>
<p><img src="/images/mongodb/index-sort-1.png" style="width: 400px;"></p>
<h3 id="索引顺序"><a href="#索引顺序" class="headerlink" title="索引顺序"></a>索引顺序</h3><p>索引顺序可能影响查询和排序。</p>
<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>查询：<code>find({a: 2, b: {$gte: 2, $lte: 3}, c: 1})</code>。</p>
<p>若索引为 <code>{a: 1, b: 1, c: 1}</code>，则查询过程如下：</p>
<p><img src="/images/mongodb/index-order-filter-1.png" style="width: 400px;"></p>
<ul>
<li>需要 4 次二分查找；</li>
</ul>
<p>若索引为 <code>{a: 1, c: 1, b: 1}</code>，则查询过程如下：</p>
<p><img src="/images/mongodb/index-order-filter-2.png" style="width: 400px;"></p>
<ul>
<li>需要 3 次二分查找；</li>
</ul>
<p>范围查找的键最好在索引的最后，以避免过早分叉，一分叉，后面的所有查询操作数量要翻倍。</p>
<h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><p>索引顺序将影响索引是否能帮助排序。</p>
<p>假设查询为：<code>find({a: 2, b: {$gte: 2, $lte: 3}}).sort({c: 1})</code>。</p>
<p>若索引顺序为 <code>{a: 1, b: 1, c: 1}</code>，则执行过程如下：</p>
<p><img src="/images/mongodb/index-order-sort-1.png" style="width: 400px;"></p>
<p>该索引无法帮助排序，因为按 b 过滤之后出现分叉，每个 c 分支内是有序的，但无法保证两个 c 分支之间的顺序，因此必须 <strong>内存排序</strong>。</p>
<p>若索引顺序为 <code>{a: 1, c: 1, b: 1}</code>，则执行过程如下：</p>
<p><img src="/images/mongodb/index-order-sort-2.png" style="width: 400px;"></p>
<p>此时在第二层可以按 c 的索引顺序进行遍历，对于每个 c 元素，再继续进行范围查找，最后的结果是 c 升序的，因此无需内存排序。</p>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><p>创建索引是一项非常耗时的操作，因为需要读取磁盘上的所有文档。</p>
<p>MongoDB 提供两种创建方式，通过 <code>background</code> 字段进行控制：</p>
<ul>
<li>前台创建</li>
<li>后台创建</li>
</ul>
<p>其中前台方式会锁住集合，造成暂时的服务不可用，因此几乎不推荐使用；后台方式不锁集合，但创建时间要长一些。</p>
<p>考虑索引顺序可能影响过滤、排序，推荐按如下方式创建索引：</p>
<ol>
<li>精确匹配字段：最前面</li>
<li>排序字段：中间<ol>
<li>最大化利用索引排序，避免内存排序</li>
</ol>
</li>
<li>范围匹配字段：最后面<ol>
<li>减少过滤时的比较次数，提升过滤效率</li>
</ol>
</li>
</ol>
<p>按照该原则创建出的索引一般是最优的。</p>
<h2 id="使用原则"><a href="#使用原则" class="headerlink" title="使用原则"></a>使用原则</h2><p><strong>1. 保证内存足以容纳索引（最基本）</strong></p>
<blockquote>
<p>使用 <code>db.stats().indexSize</code> 查看索引大小，单位为字节。</p>
</blockquote>
<p>CPU 缓存、内存、硬盘之间速度差别：</p>
<ul>
<li>缓存：馒头已经在嘴边，只需要咬一口；</li>
<li>内存：满足在盘子里，需要拿起来再咬一口；</li>
<li>机械硬盘：需要播种小麦、收割、磨面、做馒头，最后才能吃；</li>
<li>SSD：先去超时买面粉，然后做馒头，最后吃；</li>
</ul>
<p>若内存太小无法容纳索引，MongoDB 将使用 LRU 算法将索引在内存和硬盘之间进行交换。</p>
<p>因此若某查询所需索引不在内存，MongoDB 需要先将硬盘上的索引加载到内存中，然后再借助索引进行查找，最后的性能非常差，通常是无法接受的：</p>
<p><img src="/images/mongodb/mongodb-memory-model.png" style="width: 400px;"></p>
<p><strong>2. 一个查询至少要命中一个索引</strong></p>
<p>MongoDB 认为耗时超过 100ms 的查询为慢查询，并将其记录在日志中。</p>
<p><strong>3. 一个索引至少要被一个查询命中</strong></p>
<p>否则可以直接删除，因此索引是有代价的：</p>
<ul>
<li>影响写入操作</li>
<li>占用内存空间</li>
</ul>
<p>使用 <code>db.test.aggregrate([{$indexStats: {}}])</code> 可查看上次 MongoDB 重启后的索引命中情况。</p>
<p><strong>4. 在保证查询效率的前提下，索引应尽量少</strong></p>
<h2 id="特殊索引"><a href="#特殊索引" class="headerlink" title="特殊索引"></a>特殊索引</h2><h3 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h3><p>索引通过比较索引键进行工作，索引键越长，则比较操作消耗的 CPU 资源越多，而且当键大于 1024 字节时，MongoDB 禁止文档插入。</p>
<p>但如果需要索引的键就是非常长（文件路径、URL 路径等）怎么办呢？</p>
<p>此时用哈希索引，可以显著减少键的长度。</p>
<h3 id="部分索引"><a href="#部分索引" class="headerlink" title="部分索引"></a>部分索引</h3><p>有时仅需对部分文档创建索引，此时可以用部分索引，可减少索引大小，节省内存使用。</p>
<p>典型应用场景为：</p>
<ul>
<li>状态机</li>
<li>消息队列</li>
</ul>
<p>例如，若仅对 <code>init</code> 和 <code>error</code> 两个状态的文档创建索引，则：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.createIndex</span>(&#123;</span><br><span class="line">  <span class="attribute">stat</span>: <span class="number">1</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attribute">partialFilterExpression</span>: &#123;</span><br><span class="line">    stat: &#123;</span><br><span class="line">      $in: [<span class="string">'init'</span>, <span class="string">'error'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="TTL-索引"><a href="#TTL-索引" class="headerlink" title="TTL 索引"></a>TTL 索引</h3><p>TTL 索引可自动清理不重要的过期数据，例如过期的 session。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.test</span><span class="selector-class">.createIndex</span>(&#123;</span><br><span class="line">  <span class="attribute">created</span>: <span class="number">1</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attribute">expireAfterSeconds</span>: <span class="number">3600</span> * <span class="number">24</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>TTL 索引过期后，将自动删除对应的文档。</p>
<h3 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h3><p>关系型数据库的索引，无法支持 <strong>模糊匹配</strong>（<code>like</code>），MongoDB 索引也一样，无法支持 <strong>正则表达式</strong>。</p>
<p>唯一的例外是前缀固定的正则表达式，这种是可以命中索引的，但前缀固定的应用场景太局限了：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="selector-tag">a</span>: <span class="string">'This is a tree.'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">find</span><span class="params">(&#123;a: /tree/&#125;)</span></span>    <span class="comment">// 模糊匹配不能命中索引</span></span><br><span class="line"><span class="function"><span class="title">find</span><span class="params">(&#123;a: /^tree/&#125;)</span></span>   <span class="comment">// 前缀固定的模糊匹配可以命中索引</span></span><br></pre></td></tr></table></figure>
<p>第二条虽然命中了索引，但并没有什么卵用，此时可以用全文索引取代正则表达式。</p>
<blockquote>
<p>实际上如果真要用全文索引，还不如直接上 ES。</p>
</blockquote>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h4 id="1-命中索引的查询是否一定更快？"><a href="#1-命中索引的查询是否一定更快？" class="headerlink" title="1. 命中索引的查询是否一定更快？"></a>1. 命中索引的查询是否一定更快？</h4><p>一般而言，命中索引查询速度更快。</p>
<p>索引的作用是从一个大数据集中过滤出一个 <strong>小数据集</strong>，而 OLAP 应用（分析型应用）需要处理大量数据（比如需要加载一个月的全部数据），因此 OLAP 场景中命中索引不一定更快，此时可能集合扫描要更快。</p>
<h4 id="2-有多个可用索引，最后会使用哪个？"><a href="#2-有多个可用索引，最后会使用哪个？" class="headerlink" title="2. 有多个可用索引，最后会使用哪个？"></a>2. 有多个可用索引，最后会使用哪个？</h4><p>若某查询语句可能使用多个索引，则首次执行时 MongoDB 将为所有 index 分别生成查询计划，并执行所有计划，第一个查询出 101 条数据的 index 将被选中，以后执行该查询时，将直接使用该索引。</p>
<p>因此首次执行查询时，速度可能会稍微慢一点，而且 MongoDB 重启后需要重新进行评估，当然也可以通过指令强制进行更新。</p>
<h4 id="3-查询慢？"><a href="#3-查询慢？" class="headerlink" title="3. 查询慢？"></a>3. 查询慢？</h4><ul>
<li>是否命中索引？</li>
<li>是否有类似 <code>toArray</code> 的操作，导致将结果集一次性加载到内存中？</li>
</ul>
<h4 id="4-CPU-占用高？"><a href="#4-CPU-占用高？" class="headerlink" title="4. CPU 占用高？"></a>4. CPU 占用高？</h4><p>正常场景中，MongoDB 几乎不怎么消耗 CPU。若未命中索引，CPU 利用明显升高。</p>
<h4 id="5-IO-高（最常见）？"><a href="#5-IO-高（最常见）？" class="headerlink" title="5. IO 高（最常见）？"></a>5. IO 高（最常见）？</h4><ul>
<li>未命中索引<ul>
<li>MongoDB 会把文档从磁盘加载到内存中以进行查询操作，从而造成大量磁盘 IO；</li>
</ul>
</li>
<li>内存不足<ul>
<li>MongoDB 内存将与硬盘进行交换，以便将所需索引从磁盘加载到内存，也会造成大量 IO；</li>
<li><code>nYields</code> 字段</li>
</ul>
</li>
</ul>
<p>其中 3-5 是常见的性能问题，性能问题的原因非常多，这里仅仅从索引角度进行分析，并不全面。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/09/16/2018-09-16-mongodb-objectid-generation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/2018-09-16-mongodb-objectid-generation/" itemprop="url">
                  MongoDB | ObjectId 生成
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-16 21:31:01 / 修改时间：23:32:22" itemprop="dateCreated datePublished" datetime="2018-09-16T21:31:01+08:00">2018-09-16</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/16/2018-09-16-mongodb-objectid-generation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/16/2018-09-16-mongodb-objectid-generation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在 MongoDB 中每个 document 都有一个 <code>_id</code> 字段，该字段用于标识（通常是唯一标识）collection 中的特定 document。</p>
<p><code>_id</code> 字段可以是任何类型，但默认类型为 <code>ObjectId</code>，<code>ObjectId</code> 是一个 BSON 类型，长度为 12 字节，且：</p>
<ul>
<li>4 字节：时间戳</li>
<li>3 字节：机器标识码</li>
<li>2 字节：进程 ID（pid）</li>
<li>3 字节随机数/自增计数器</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/16/2018-09-16-mongodb-objectid-generation/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/09/09/2018-09-09-source-code-reading-threadlocal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/09/2018-09-09-source-code-reading-threadlocal/" itemprop="url">
                  源码夜读 | ThreadLocal
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-09 22:23:16" itemprop="dateCreated datePublished" datetime="2018-09-09T22:23:16+08:00">2018-09-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-09-16 21:45:48" itemprop="dateModified" datetime="2018-09-16T21:45:48+08:00">2018-09-16</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/源码夜读/" itemprop="url" rel="index"><span itemprop="name">源码夜读</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/09/2018-09-09-source-code-reading-threadlocal/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/09/2018-09-09-source-code-reading-threadlocal/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>当状态变量 <strong>非线程安全</strong> 时，是无法在并发场景中直接共享的，常见的解决办法有：</p>
<ul>
<li>同步（<code>synchronized</code> 或 <code>Lock</code>）</li>
<li>修改为线程安全的实现</li>
<li>线程封闭</li>
</ul>
<p>其中第三种方法有两种实现方式：</p>
<ul>
<li>将对共享状态的读写操作集中到 <strong>一个线程</strong> 中，即在事实上将该变量 <strong>封闭</strong> 到单线程；</li>
<li><code>ThreadLocal</code>；</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/09/2018-09-09-source-code-reading-threadlocal/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/09/02/2018-09-02-reading-I-heart-logs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/02/2018-09-02-reading-I-heart-logs/" itemprop="url">
                  读书 | I heart Logs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-02 21:24:34 / 修改时间：22:01:08" itemprop="dateCreated datePublished" datetime="2018-09-02T21:24:34+08:00">2018-09-02</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/02/2018-09-02-reading-I-heart-logs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/02/2018-09-02-reading-I-heart-logs/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>豆瓣：<a href="https://book.douban.com/subject/26107374/" target="_blank" rel="noopener">I heart Logs</a></p>
<p>这是一本不到 60 页的小册子，它的作者 Jay Kreps 可谓大名鼎鼎，他是 Kafka、Samza、Voldemort 等多个开源项目的最初作者，目前是 Confluent 的联合创始人兼 CEO，所以不要因为页数少而轻视它。</p>
<p>这书实际由 Jay Kreps 的一系列博文整理而成，博文有中文版，当然了，本书出版于 2014 年，其中的很多观点在当时是非常超前的，但 4 年后的今天，很多内容已经早已为大家熟知。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/02/2018-09-02-reading-I-heart-logs/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/29/2018-08-29-reading-java-concurrency-in-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/2018-08-29-reading-java-concurrency-in-practice/" itemprop="url">
                  读书 | Java 并发编程实战
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-29 23:01:22" itemprop="dateCreated datePublished" datetime="2018-08-29T23:01:22+08:00">2018-08-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-30 00:23:20" itemprop="dateModified" datetime="2018-08-30T00:23:20+08:00">2018-08-30</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/2018-08-29-reading-java-concurrency-in-practice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/2018-08-29-reading-java-concurrency-in-practice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://book.douban.com/subject/10484692/" target="_blank" rel="noopener">Java 并发编程实战</a> 是 Java 并发编程领域的重量级图书，作者阵容异常强大，都是 JSR 166 专家组成员，设计实现了 Java 的主要并发工具，相信 Java 司机们对此都不陌生。</p>
<p>几年前在学校的时候我就读过本书，那时缺乏相关背景和基础，只能读懂二三成，当时感觉并发编程好难啊 :(</p>
<p>如今工作了两年，也算有了些经验，再次拿起本书，已经没有了当初的晦涩难懂，取而代之的是大呼过瘾，让人手不释卷。整个 8 月里，早晨上班之前读一个小时，加上几个周末，竟然一个月就读完了。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/29/2018-08-29-reading-java-concurrency-in-practice/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/20/2018-08-20-reading-java-8-lambdas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/2018-08-20-reading-java-8-lambdas/" itemprop="url">
                  读书 |《Java 8函数式编程》
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-20 22:33:47 / 修改时间：23:38:13" itemprop="dateCreated datePublished" datetime="2018-08-20T22:33:47+08:00">2018-08-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/20/2018-08-20-reading-java-8-lambdas/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/20/2018-08-20-reading-java-8-lambdas/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>近年来函数式编程语言迎来了一次小爆发，热的发紫的 Spark 是用 Scala 实现的，Storm 是用 Clojure 实现的，Jetbrains 家的 Kotlin 也在紧锣密鼓的攻城略地，这些新型语言可利用庞大的 Java 生态系统，并且在语言特性上大大超越了保守的原住民 Java，程序员们当然快活，但 Java 却坐不住了，于是有了 Java 8 大刀阔斧的进步。</p>
<p>在我看来，Java 8 最重要的新特性包括：</p>
<ul>
<li>lambda 表达式（包括用 lambda 表达式增强的集合框架）</li>
<li><code>Optional</code></li>
<li><code>Stream</code></li>
<li><code>CompletableFuture</code></li>
</ul>
<p>说是新特性其实很勉强，因为 Java 8 早在 2014 年 3 月就发布了，而且 Java 9 在去年 9 月份也发布了，广大吃瓜群主肯定吃了一惊，哈哈。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/20/2018-08-20-reading-java-8-lambdas/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/18/2018-08-18-java-8-functional-programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/18/2018-08-18-java-8-functional-programming/" itemprop="url">
                  Java 8 Stream 入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-18 12:24:17" itemprop="dateCreated datePublished" datetime="2018-08-18T12:24:17+08:00">2018-08-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 22:32:20" itemprop="dateModified" datetime="2018-08-20T22:32:20+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/18/2018-08-18-java-8-functional-programming/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/18/2018-08-18-java-8-functional-programming/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>面向对象编程是对 <strong>数据</strong> 进行抽象，函数式编程是对 <strong>行为</strong> 进行抽象，现实世界中数据与行为并存，为不同的任务选择合适的抽象方式，两全其美。</p>
<p>通常而言，函数式代码在 <strong>效率</strong> 上不是最优的，但可读性比面向对象代码好，如今处理器性能已经过剩，若不是特别关注效率的场景，则可读性优先。</p>
<p>虽然 Java 8 对 FP 支持偏薄弱，例如不支持惰性求值、不可变数据结构、typeclass 等，但相比以前，已经大大进步了。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/18/2018-08-18-java-8-functional-programming/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/14/2018-08-14-source-code-reading-executor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/14/2018-08-14-source-code-reading-executor/" itemprop="url">
                  源码夜读 | Executor
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-14 12:33:37 / 修改时间：22:55:33" itemprop="dateCreated datePublished" datetime="2018-08-14T12:33:37+08:00">2018-08-14</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/源码夜读/" itemprop="url" rel="index"><span itemprop="name">源码夜读</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/14/2018-08-14-source-code-reading-executor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/14/2018-08-14-source-code-reading-executor/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在 Java 并发编程中，<code>Runnable</code> 是逻辑上的工作单元，用来表示任务，而 <code>Thread</code> 是执行任务的机制，不过 <code>Thread</code> 过于底层、过于基础，因此需要复杂的资源管理，比如创建多少线程合适？当线程崩溃会如何处理？如何停止进行中的任务？</p>
<p>因此一般不直接使用 <code>Thread</code> 执行任务，取而代之的是 <code>Executor</code> 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/14/2018-08-14-source-code-reading-executor/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/12/2018-08-12-source-code-reading-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/2018-08-12-source-code-reading-object/" itemprop="url">
                  源码夜读 | Object
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-12 19:21:55 / 修改时间：23:40:40" itemprop="dateCreated datePublished" datetime="2018-08-12T19:21:55+08:00">2018-08-12</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/源码夜读/" itemprop="url" rel="index"><span itemprop="name">源码夜读</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/12/2018-08-12-source-code-reading-object/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/12/2018-08-12-source-code-reading-object/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><code>Object</code> 源码非常简单，只有区区几个方法，除 <code>registerNatives</code>、<code>getClass</code> 外，其余方法可分为两类：</p>
<ul>
<li>子类覆盖<ul>
<li><code>hashCode</code></li>
<li><code>equals</code></li>
<li><code>clone</code></li>
<li><code>toString</code></li>
<li><code>finalize</code></li>
</ul>
</li>
<li>并发控制<ul>
<li><code>notify</code></li>
<li><code>notifyAll</code></li>
<li><code>wait</code> 3 个重载版本</li>
</ul>
</li>
</ul>
<p>虽然源码很简单，但要准确理解它们的含义却没那么容易，下面介绍这几个方法的用途，以及惯用法。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/12/2018-08-12-source-code-reading-object/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://songkun.me/2018/08/09/2018-08-09-java-sorting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Song Kun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随便写写">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/09/2018-08-09-java-sorting/" itemprop="url">
                  关于 Java 排序的一切
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-09 21:38:09 / 修改时间：23:20:12" itemprop="dateCreated datePublished" datetime="2018-08-09T21:38:09+08:00">2018-08-09</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/09/2018-08-09-java-sorting/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/09/2018-08-09-java-sorting/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>排序是一项非常基础、常见的功能，几乎所有应用都会涉及，本文介绍 Java 排序的基本知识。</p>
<h2 id="基本类型排序"><a href="#基本类型排序" class="headerlink" title="基本类型排序"></a>基本类型排序</h2><p>首先排序发生在容器中，在 Java 中表现为数组、<code>List</code>、<code>Set</code> 和 <code>Map</code>。</p>
<h3 id="数组排序"><a href="#数组排序" class="headerlink" title="数组排序"></a>数组排序</h3><blockquote>
<p>注意 <code>Arrays.sort</code> 是就地排序，会修改被排序的数组。</p>
</blockquote>
<p><code>Arrays.sort</code> 可以对基本数字类型的数组排序，例如 <code>int</code>、<code>byte</code>、<code>char</code>、<code>double</code>、<code>float</code>、<code>short</code> 和 <code>long</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] intArray = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>, -<span class="number">2</span>, -<span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -3, -2, -1, 1, 2, 3</span></span><br><span class="line">Arrays.sort(intArray);</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/09/2018-08-09-java-sorting/#更多" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Song Kun</p>
              <p class="site-description motion-element" itemprop="description">Java for living, Scala for fun!</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/satansk" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:songkun.fp@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Song Kun</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.2.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  

  
    <script id="dsq-count-scr" src="https://songkun.disqus.com/count.js" async></script>
  

  





	





  












  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
