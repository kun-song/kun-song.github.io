---
title: 为什么需要事务？
date: 2019-08-10 14:49:26
tags:
  - 事务
categories: 数据库
---

事务是 DB 对外的抽象，访问 DB 时必然涉及事务，即使没有显式提交一个事务，因为读写操作的行为都遵循事务的约束。

<!-- more -->

应用访问数据库时，可能出现很多错误：

1. 进程崩溃、主机崩溃
   1. 数据库进程 or 主机崩溃，读操作时还好，写操作时可能导致 **部分更新**，造成数据不一致；
   2. 客户端崩溃，若崩溃时客户端正在执行 **一系列写操作**，崩溃后，部分写执行成功，后续写根本没发送至 DB，也会造成数据不一致；
2. 读取到 partially updated 的数据，没有意义；
3. 数据库硬盘故障、文件损坏；
4. 网络中断
   1. 客户端与数据库之间
   2. 数据库各节点之间
5. 并发问题
   1. 多个客户端同时修改同一份数据，造成 **数据互相覆盖**；
   2. 客户端之间执行读写操作时，根据执行顺序不同，结果 **不可预测**，即 **竞态条件**；

由应用自己解决以上问题，有如下弊端：

1. 容错处理非常复杂，难以正确实现；
1. 每个应用都要重复实现容错逻辑，无法复用；

因此，DB 提供 **事务**，将应用从繁杂的错误处理中解脱出来。

事务旨在简化客户端访问 DB 时的容错处理，它屏蔽 or 简化了上面的问题：

1. 屏蔽了部分更新、硬盘故障、网络中断等问题；
1. 简化了 **并发问题**；

应用可以假设被事务屏蔽的问题 **根本不存在**，因此通常称事务提供了某些 **安全保证**（safty guarentees），应用代码可直接建立在这些安全保证之上，这也是计算机中常见的分层思维，事务屏蔽复杂的底层故障，应用直接使用事务提供的抽象。

>事务提供的安全保证即 ACID。

最后，事务只是一种人为设计的容错机制，不同 DB 的事务实现有 **强弱** 之分，并不完全相同；而且也可以通过 **其他机制** 屏蔽上面的问题，并非一定要使用事务。
