---
title: 事务的定义
date: 2019-08-10 15:29:30
tags:
  - 事务
categories: 数据库
---

从概念上讲，事务非常简单，四十多年从未变过：

>事务是一种机制，借助事务，DB 可以把 **多个读写操作** 整合为 **一个逻辑单元**，该逻辑单元即 **一个事务**。

<!-- more -->

不过概念本身通常没什么卵用，我们需要通过概念的行为 or 属性才能真正理解概念。

## 安全保证

事务的设计目的是为应用提供一系列 **安全保证**，以简化数据库的使用，因此它提供的安全保证才能真正定义事务。

事务提供四个安全保证，即 ACID：

1. Atomicity
2. Consistency
3. Isolation
4. Durability

ACID 仍然是纯粹的概念，它们具体的行为 or 属性仍然不确定。

## 关系型数据库

对于传统的关系型数据库而言，各数据库的 ACD 基本类似，但 I 可能差别较大，为标准化 I，ANSI SQL 提出四种事务隔离级别：

1. read uncommitted
2. read committed
3. repeatable read
4. serializability

然而，并非所有数据库的隔离级别都遵循标准，例如：

* Oracle 虽然实现了名为 serializability 的隔离级别，但实际实现是 snapshot isolation，比 serializability 稍弱；
* PostgreSQL 虽然可以配置 4 个隔离级别，但实际只实现了 3 个，它的 read uncommitted 和 read committed 实现都是 read committed；

## NoSQL

NoSQL 重新兴起于 2000 年，一直火热到今天，这段时间由于互联网的普及，数据量暴增，传统的关系型数据库对大数据场景处理乏力，NoSQL 为应对海量数据，采用了新式数据模型（文档、图、对象等）、复制、分片等技术。

对于分布式数据库，实现全局事务会带来很大的 **性能开销**，因此有的 NoSQL 完全抛弃了事务，有的提供远比传统事务 **更弱** 的安全保证。

但很多严肃业务离了事务（传统意义上的，严格的安全保证）根本玩不转，因此部分 NoSQL 后来又慢慢加入事务支持，例如 MongoDB 最初完全不提供事务，后来 4.0 版本提供复制集内的事务，未来计划跨分片的事务，MongoDB 号称支持多文档的 ACID 事务，但实际上它的 I 是 snapshot isolation，也不是 ANSI SQL 规定的四种之一。

>事实上，对于 **单文档** 操作，MongoDB 开始就提供 ACID 事务，通常说 MongoDB 不支持事务，是指它不支持 **多文档** 操作事务。
>
>MongoDB 的表结构设计哲学是以冗余换取简洁，即在关系型数据库中相互关联的 **多个表**，MongoDB 推荐将其放到 **单个集合** 中，通过这种设计方式，单文档事务已经可以支持很多应用了，但明显，想要获取更多用户，这种事务还是偏弱。

类似的还有 Tikv，它也完整支持 ACID，但 I 实现方式为 MVCC（multi-version concurrency control）。

>支持事务，即提供 ACID 四个安全保证。

## 总结

不同数据库的事务实现细节差别很大，如果要使用事务，一定要查阅数据库的文档，准确理解它提供的 ACID 属性的细节才行。
